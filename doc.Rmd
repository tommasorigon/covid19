---
output: 
  html_document: 
    theme: united
---

### Autori

Gli autori di questa applicazione sono <a href='https://www.unimib.it/matteo-maria-pelagatti'><b>Matteo Pelagatti</b></a> e <a href='https://tommasorigon.github.io'><b>Tommaso Rigon</b></a>, a cui è possibile scrivere per eventuali segnalazioni e richieste di chiarimenti.

### I dati utilizzati

Questa applicazione fa uso di diverse fonti informative, che sono tutte di pubblico dominio. 

I dati originali relativi ai **nuovi positivi, decessi e pazienti in terapia intensiva** sono resi disponibili dal Dipartimento della protezione civile a questo link: [https://github.com/pcm-dpc/COVID-19](https://github.com/pcm-dpc/COVID-19). 

I dati relativi alle **vaccinazioni** sono resi disponibili dal Commissario straordinario per l'emergenza Covid-19 a questo link: <a href='https://github.com/italia/covid19-opendata-vaccini'>https://github.com/italia/covid19-opendata-vaccini</a>. 

I dati relativi alla **popolazione residente** di regioni e province fanno riferimento al 1 Gennaio 2020 e sono disponibili sul [portale ISTAT](http://dati.istat.it/Index.aspx?QueryId=42869).


### Il codice sorgente

Il codice sorgente di questa applicazione è disponibile su GitHub a [questo link](https://github.com/tommasorigon/covid19).

### Metodologia

Il **trend** è ottenuto tramite Kalman filter, stimato sulla scala logaritmica. Il trend rappresenta una versione dei dati depurata dalle oscillazioni casuali e quindi è di più facile interpretazione. 

Il **tasso di crescita** invece rappresenta la variazione percentuale giornaliera del trend. Ad esempio, il tasso di crescita di oggi si calcola tramite la formula: 

$$
\text{tasso di crescita (%)} = 100*\frac{\text{trend di oggi} - \text{trend di ieri}}{\text{trend di ieri}}.
$$

### Più tecnicamente

Si assume che la serie storica $Y_t$ (nuovi casi, decessi giornalieri e ricoveri in terapia intensiva) sia il frutto del prodotto di tre componenti: un livello, una stagionalità e una componente "rumore", in formula
$$
  Y_t = L_t \cdot S_t \cdot R_t.
$$

Utilizzando il logaritmo naturale possiamo scrivere
$$
  y_t = l_t + s_t + r_t,
$$
dove $y_t = \log(Y_t)$, $l_t = \log(L_t)$, $s_t = \log(S_t)$ e $r_t = \log(R_t)$.

Il livello al tempo $t+1$ è dato dal livello al tempo $t$ moltiplicato per un tasso di crescita lordo $B_t$,
$$
  L_{t+1} = B_t \cdot L_{t}.
$$
Se il valore $B_t$ è superiore a 1, il livello è in crescita, se $B_t$ è inforiore a 1, il livello sta scendendo. Il tasso di crescita (netto) è dato da
$$
  B_t - 1 = \frac{L_{t+1}}{L_t} - 1 = \frac{L_{t+1} - L_t}{L_t}
$$
Passando ai logaritmi si ha
$$
  l_{t+1} = b_t + l_t,
$$
con $b_t = \log(B_t)$.

Nel modello assumiamo che il logaritmo del tasso lordo (che per la linearità del logaritmo in un intorno di 1, approssima bene il tasso netto) evolva come una passeggiata eleatoria:
$$
  b_{t+1} = b_t + z_t,
$$
dove $z_t$ è una quantità aleatoria a media zero e varianza $\sigma_z^2$.

Si suppone che anche il fattore stagionale e il rumore evolgano nel tempo in modo casuale. Il primo nel modo seguente
$$
  s_{t+1} = s_{t} + s_{t-1} + \ldots s_{t-5} + w_t,
$$
dove $w_t$ è una quantità aleatoria a media zero e varianza $\sigma_w^2$. Il rumore $r_t$ è anche una quantità aleatoria con media zero e varianza $\sigma_r^2$.

La stima delle tre varianze avviene col metodo della massima verosimiglianza supponendo che le tre quantità aleatorie siano gaussiane (e quindi $Y_t$ sia processo log-normale) e le quantità non osservabili $l_t$ e $b_t$ sono estratte per mezzo di algoritmi che minimizzano l'errore quadratico medio (filtro di Kalman e smoother).

Gli algoritmi ci resititusicono le quantità
$$
  \hat{l}_t = \mathrm{E}\left( l_t | \text{dati} \right) \;\text{ e }\;
  \lambda_t = \mathrm{VAR}\left( l_t | \text{dati} \right),
$$
e quindi la stima del livello $L_t$ (sotto le ipotesi illustrate) è data da
$$
  \mathrm{E}\left( L_t | \text{dati} \right) = \exp(\hat{l}_t + 0.5\lambda_t).
$$

Lo smoother ci restitusice anche
$$
  \hat{b}_t = \mathrm{E}\left( b_t | \text{dati} \right) \;\text{ e }\;
  \beta_t = \mathrm{VAR}\left( b_t | \text{dati} \right),
$$
e quindi
$$
  \mathrm{E}\left( B_t | \text{dati} \right) = \exp(\hat{b}_t + 0.5\beta_t).
$$
da cui stimiamo il tasso di crescita
$$
  \exp(\hat{b}_t + 0.5\beta_t) - 1.
$$